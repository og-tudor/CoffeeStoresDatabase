{% extends "base.html" %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/coffee_stores.css') }}">
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="statistic1">
        <p>Statistic 1: Coffee Stores Data</p>
        <table id="statistic1-table">
            <thead>
                <tr>
                    <th>Store</th>
                    <th>City</th>
                    <th>Revenue Goal</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated here -->
            </tbody>
        </table>
    </div>
    <div id="chart" class="statistic3"></div>
</div>
<script>
    $(document).ready(function () {
        // Load table and chart data for Statistic 1
        $.get('/api/statistic1', function (data) { // Correct endpoint
            const tableBody = $('#statistic1-table tbody');
            tableBody.empty();

            const stores = [];
            const goals = [];

            // Populate table rows and prepare data for chart
            data.forEach(item => {
                tableBody.append(`
                    <tr>
                        <td>${item.Cafea}</td>
                        <td>${item.Oras}</td>
                        <td>${item.Obiectiv_Venit}</td>
                    </tr>
                `);
                stores.push(item.Cafea); // Store names for chart
                goals.push(item.Obiectiv_Venit); // Revenue goals for chart
            });

            // Generate bar chart
            const chartData = [{
                x: stores,
                y: goals,
                type: 'line',
                marker: { color: '#BE7462' }
            }];

            const layout = {
                title: 'Coffee Stores Revenue Goals',
                paper_bgcolor: '#514A73',
                plot_bgcolor: '#514A73',
                font: { color: 'white' }
            };

            Plotly.newPlot('chart', chartData, layout);
        }).fail(function (error) {
            console.error("Error fetching data:", error);
        });
    });
</script>

{% endblock %}
